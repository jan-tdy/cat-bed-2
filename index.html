<!DOCTYPE html>
<html>
<head>
  <title>Inteligentný pelech pre mačky</title>
</head>
<body>
  <h1>Inteligentný pelech pre mačky</h1>

  <h2>Obsadenosť</h2>
  <div id="occupancy"></div>

  <h2>Vyhrievanie</h2>
  <div id="heating"></div>

  <h2>Režim "nerušiť"</h2>
  <div id="dnd"></div>

  <h2>Manuálne kŕmenie</h2>
  <form id="manualFeedForm">
    <label for="feedInfo">Informácie o kŕmení:</label>
    <input type="text" id="feedInfo" name="feedInfo">
    <button type="submit">Nastaviť</button>
  </form>

  <h2>Ovládanie</h2>
  <table>
    <thead>
      <tr>
        <th>Miesto</th>
        <th>Obsadenosť</th>
        <th>Vyhrievanie</th>
        <th>Nerušiť</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td><button onclick="toggleOccupancy(0)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(0)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(0)">Prepnúť</button></td>
      </tr>
      <tr>
        <td>2</td>
        <td><button onclick="toggleOccupancy(1)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(1)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(1)">Prepnúť</button></td>
      </tr>
      <tr>
        <td>3</td>
        <td><button onclick="toggleOccupancy(2)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(2)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(2)">Prepnúť</button></td>
      </tr>
      <tr>
        <td>4</td>
        <td><button onclick="toggleOccupancy(3)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(3)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(3)">Prepnúť</button></td>
      </tr>
      <tr>
        <td>5</td>
        <td><button onclick="toggleOccupancy(4)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(4)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(4)">Prepnúť</button></td>
      </tr>
      <tr>
        <td>6</td>
        <td><button onclick="toggleOccupancy(5)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(5)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(5)">Prepnúť</button></td>
      </tr>
      <tr>
        <td>7</td>
        <td><button onclick="toggleOccupancy(6)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(6)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(6)">Prepnúť</button></td>
      </tr>
      <tr>
        <td>8</td>
        <td><button onclick="toggleOccupancy(7)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(7)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(7)">Prepnúť</button></td>
      </tr>
      <tr>
        <td>9</td>
        <td><button onclick="toggleOccupancy(8)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(8)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(8)">Prepnúť</button></td>
      </tr>
      <tr>
        <td>10</td>
        <td><button onclick="toggleOccupancy(9)">Prepnúť</button></td>
        <td><button onclick="toggleHeating(9)">Prepnúť</button></td>
        <td><button onclick="toggleDoNotDisturb(9)">Prepnúť</button></td>
      </tr>
    </tbody>
  </table>

  <script>
    // Funkcia pre aktualizáciu dát
    function updateData() {
      // Získanie dát z ESP32
      fetch('/occupancy')
        .then(response => response.text())
        .then(data => document.getElementById('occupancy').innerText = data);

      fetch('/heating') // Pridané pre získanie stavu vyhrievania
        .then(response => response.text())
        .then(data => document.getElementById('heating').innerText = data);

      fetch('/dnd')
        .then(response => response.text())
        .then(data => document.getElementById('dnd').innerText = data);

      fetch('/feeding')
        .then(response => response.text())
        .then(data => document.getElementById('feeding').innerText = data);
    }

    // Aktualizácia dát každú sekundu
    setInterval(updateData, 1000);

    // Odoslanie formulára pre manuálne kŕmenie
    document.getElementById('manualFeedForm').addEventListener('submit', function(event) {
      event.preventDefault();
      const feedInfo = document.getElementById('feedInfo').value;
      fetch('/setManualFeed', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `feedInfo=${feedInfo}`
      })
      .then(response => response.text())
      .then(data => console.log(data));
    });

    // Funkcie pre ovládanie
    function toggleOccupancy(index) {
      fetch(`/occupancy/${index}`)
        .then(response => response.text())
        .then(data => console.log(data));
    }

    function toggleHeating(index) {
      fetch(`/heating/${index}`)
        .then(response => response.text())
        .then(data => console.log(data));
    }

    function toggleDoNotDisturb(index) {
      fetch(`/dnd/${index}`)
        .then(response => response.text())
        .then(data => console.log(data));
    }
  </script>
</body>
</html>
